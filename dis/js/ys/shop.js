"use strict";$(function(){function n(){600<=window.scrollY?$("#toTop").css("display","block"):$("#toTop").css("display","none")}n(),window.onscroll=function(){n()},$("#toTop").click(function(){var n=window.scrollY;clearInterval(a);var a=setInterval(function(){(n-=32)<0?clearInterval(a):window.scrollTo(0,n)})});var e,a=Cookie.get("name");function i(){$(document).scrollTop()<e?$(".car_bttom").addClass("tabNav_fix"):$(".car_bttom").removeClass("tabNav_fix")}a&&($(".reg_r li:first").html('<a href="JavaScript:;">\n            '+a+"\n        </a>"),$(".reg_r li:first a").css({padding:"0px","line-height":"25px",border:"none","box-shadow":" 0 0 0"}),$(".reg_r li:eq(1)").html('<a href="JavaScript:;" id="outLogin">\n            [退出]\n        </a>')),$("#outLogin").click(function(){var n=new Date;n.setDate(n.getDate()-7),Cookie.set("name","",{expires:n,path:"/"}),location.reload()}),$(".reg_r li").hover(function(){$(this).find("ul").css({display:"block"})},function(){$(this).find("ul").css("display","none")}),$(window).scroll(function(){i()}),$.ajax({type:"get",url:"../api/shop_car.php",data:{way:"shop"},async:!0,success:function(n){var a=JSON.parse(n);if(a.length){$(".carts").css("display","block");var c=a.map(function(n){return'<ul class="single_goods">\n                                <li class="single_1">\n                                    <p><input type="checkbox" class="goods_checkbox" /></p>\n                                </li>\n                                <li class="single_2">\n                                    <dl class="clearfix">\n                                        <dt>\n                                            <a href="javascript:;"><img src="'+n.imgs+'" alt="" /></a>\n                                        </dt>\n                                        <dd>\n                                            <a href="javascript:;">'+n.good_name+'</a>\n                                            <p>\n                                                商品编号：<i class="goods_id">'+n.id+'</i>\n                                            </p>\n                                        </dd>\n                                    </dl>\n                                </li>\n                                <li class="single_3">\n                                    <p>颜色：<i>银灰</i></p>\n                                    <p>尺码：<i>（XL）</i></p>  \n                                </li>\n                                <li class="single_4">\n                                    <p><del>￥'+n.pricenow+'</del></p>\n                                    <p>￥<i class="unit_price">'+n.price+'</i></p>\n                                </li>\n                                <li class="single_5">\n                                    <a href="javascript:;" class="num_less">-</a><input type="text" value="'+n.num+'" class="nums" /><a href="javascript:;" class="num_add">+</a>\n                                </li>\n                                <li class="single_6">\n                                    ￥<i class="single_66">'+n.num*n.price+'</i>\n                                </li>\n                                <li class="single_7">\n                                    <a href="javascript:;" class="in_favorites">移入我的点赞</a>\n                                    <a href="javascript:;" class="delete_goods">删除</a>\n                                </li>\n                        </ul>'}).join("");$(".car_c .shop_name").after(c),e=$(".car_bttom").offset().top-$(window).height(),i()}}});var t=[],o=[];function c(n){var a=n.parent().find("input").val(),c=n.parent().prev().find(".unit_price").text(),e=(a*(c=$.trim(c))).toFixed(0);n.parent().next().html('￥<i class="single_66">'+e+"</i>"),l()}$(".car_c").on("click",".single_5 .num_add",function(){var n=$(this).prev().val();100<=++n&&(n=100);var a=$(this).parent().parent().find(".goods_id").html();$.ajax({type:"get",url:"../api/shop_car.php",async:!0,data:{id:a,num:n,way:"num"},success:function(n){}}),$(this).prev().val(n),c($(this))}),$(".car_c").on("click",".single_5 .num_less",function(){var n=$(this).next().val();--n<=1&&(n=1);var a=$(this).parent().parent().find(".goods_id").html();$.ajax({type:"get",url:"../api/shop_car.php",async:!0,data:{id:a,num:n,way:"num"},success:function(n){}}),$(this).next().val(n),c($(this))}),$(".car_c").on("keyup",".single_5 .nums",function(){var n=$(this).val(),a=$(this).parent().parent().find(".goods_id").html();100<=n&&(n=100),n<=1&&(n=1),$.ajax({type:"get",url:"../api/shop_car.php",async:!0,data:{id:a,num:n,way:"num"},success:function(n){}}),$(this).val(n),c($(this))}),$(".car_c").on("click",".delete_goods",function(){if(confirm("您确定要删除该行吗？")){$(this).parent().parent().remove();var n=$(this).parent().parent().find(".goods_id").html();$.ajax({type:"get",url:"../api/shop_car.php",async:!0,data:{id:n,way:"del"},success:function(n){}})}l()});var s=!0;function l(){t.length=0,o.length=0;for(var n=$(".car_c .goods_checkbox").size(),a=0;a<n;a++)if($(".car_c .goods_checkbox").eq(a).prop("checked")){t.push(a);var c=$(".goods_checkbox").eq(a).parent().parent().parent().find(".goods_id").html();o.push(c)}var e=0,i=0;for(a=0;a<t.length;a++){e+=1*$(".nums").eq(t[a]).val();var s=$(".single_66").eq(t[a]).text();i+=1*(s=$.trim(s))}$(".balance_num i").html(e),$(".balance_price i").html("￥"+i),r()}function r(){0==$(".goods_checkbox").size()&&$(".carts").css("display","none"),0==t.length?$(".cartPayBill a").addClass("active"):$(".cartPayBill a").removeClass("active")}$(".checkAll").on("click",function(){s?($(".car_c").find(".goods_checkbox").prop("checked","checked"),$(".checkAll").prop("checked","checked")):($(".checkAll").removeAttr("checked"),$(".car_c .goods_checkbox").removeAttr("checked")),s=!s,l()}),$(".car_c").on("click",".goods_checkbox",function(){$(this).css("background","red"),l(),s=t.length==$(".goods_checkbox").size()?($(".checkAll").prop("checked","checked"),!1):($(".checkAll").removeAttr("checked"),!0)}),$(".balance_del").on("click",function(){if(l(),confirm("您确定要删除多行吗？"))for(var n=t.length-1;0<=n;n--)$(".goods_checkbox").eq(t[n]).parent().parent().parent().remove(),$.ajax({type:"get",url:"../api/shop_car.php",async:!0,data:{id:o[n],way:"del"},success:function(n){}});r()}),$(".cartPayBill").click(function(){a?window.open("../html/login.html"):alert("结算成功！")})});